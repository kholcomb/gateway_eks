# External Secrets Operator Helm Chart Values
# Helm repo: https://charts.external-secrets.io

# Pin image version for stability
image:
  repository: ghcr.io/external-secrets/external-secrets
  tag: "v1.1.1"

# Install CRDs
installCRDs: true

# Webhook configuration
webhook:
  create: true
  resources:
    requests:
      cpu: "50m"
      memory: "64Mi"
    limits:
      cpu: "100m"
      memory: "128Mi"

# Cert controller for webhook certificates
certController:
  create: true
  resources:
    requests:
      cpu: "50m"
      memory: "64Mi"
    limits:
      cpu: "100m"
      memory: "128Mi"

# Service account with IRSA for AWS Secrets Manager access
serviceAccount:
  create: true
  name: external-secrets
  annotations:
    # TODO: Replace with your actual IAM role ARN
    eks.amazonaws.com/role-arn: "arn:aws:iam::ACCOUNT_ID:role/external-secrets-role"

# Resource limits for main controller
resources:
  requests:
    cpu: "50m"
    memory: "128Mi"
  limits:
    cpu: "200m"
    memory: "256Mi"

# Enable leader election for HA
leaderElect: true

# Log level
log:
  level: info

# Concurrent reconciles
concurrent: 5

# Metrics configuration
metrics:
  service:
    enabled: true
    port: 8080

# Pod security context (OPA compliant)
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000

# Container security context (OPA compliant)
securityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: true
  runAsNonRoot: true
  runAsUser: 1000
  capabilities:
    drop:
      - ALL

# Standard Kubernetes labels (OPA compliant)
podLabels:
  app.kubernetes.io/name: external-secrets
  app.kubernetes.io/version: "v0.12.1"
  app.kubernetes.io/component: secrets-controller
  app.kubernetes.io/part-of: litellm-stack
