# Jaeger Helm Chart Values
# Helm repo: https://jaegertracing.github.io/helm-charts
# Chart: jaeger

# Use all-in-one deployment for simplicity (suitable for dev/small prod)
# For large-scale production, consider separate collector/query/agent
provisionDataStore:
  cassandra: false
  elasticsearch: false

# All-in-one deployment (collector + query + agent in single pod)
allInOne:
  enabled: true
  replicas: 1

  image:
    repository: jaegertracing/all-in-one
    tag: "1.76.0"

  # In-memory storage (data lost on restart)
  # For production, configure Elasticsearch or Cassandra
  extraEnv:
    - name: MEMORY_MAX_TRACES
      value: "50000"

  resources:
    requests:
      cpu: "100m"
      memory: "256Mi"
    limits:
      cpu: "500m"
      memory: "512Mi"

  service:
    type: ClusterIP

  # Pod security context (OPA compliant)
  securityContext:
    runAsNonRoot: true
    runAsUser: 10001
    fsGroup: 10001

  # Container security context (OPA compliant)
  containerSecurityContext:
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: false  # Jaeger needs to write temp files
    runAsNonRoot: true
    runAsUser: 10001
    capabilities:
      drop:
        - ALL

  # Liveness and readiness probes (OPA compliant)
  livenessProbe:
    httpGet:
      path: /
      port: 14269
    initialDelaySeconds: 30
    periodSeconds: 10
    failureThreshold: 3

  readinessProbe:
    httpGet:
      path: /
      port: 14269
    initialDelaySeconds: 10
    periodSeconds: 5
    failureThreshold: 3

# Disable separate components when using all-in-one
collector:
  enabled: false

query:
  enabled: false

agent:
  enabled: false

# Storage configuration
storage:
  type: memory

# Service ports
# - 6831/udp: Thrift compact protocol (agent)
# - 6832/udp: Thrift binary protocol (agent)
# - 5778:     Config server
# - 16686:    Query UI
# - 4317:     OTLP gRPC
# - 4318:     OTLP HTTP
# - 14250:    gRPC (collector)
# - 14268:    HTTP (collector)
# - 14269:    Admin/health

# OTLP receiver enabled by default in recent Jaeger versions
# LiteLLM will send traces via OTLP to port 4317 (gRPC) or 4318 (HTTP)

# Standard Kubernetes labels (OPA compliant)
labels:
  app.kubernetes.io/name: jaeger
  app.kubernetes.io/version: "1.76.0"
  app.kubernetes.io/component: tracing
  app.kubernetes.io/part-of: litellm-stack
